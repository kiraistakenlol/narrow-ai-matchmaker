<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Data Generator Config</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 15px; border: 1px solid #ccc; border-radius: 8px; background-color: #f9f9f9; }
        h1, h2 { color: #333; }
        .config-section { margin-bottom: 25px; padding: 15px; background-color: #fff; border: 1px solid #ddd; border-radius: 5px;}
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="text"], input[type="number"], textarea { width: 95%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        textarea { min-height: 60px; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; }
        button:hover { background-color: #0056b3; }
        .attendee-type-list { list-style: none; padding: 0; }
        .attendee-type-item { display: flex; align-items: center; margin-bottom: 15px; padding: 10px; border: 1px solid #eee; border-radius: 4px; background-color: #fefefe; }
        .attendee-type-item label { flex-grow: 1; margin-left: 10px; font-weight: normal; }
        .attendee-type-item input[type="range"] { flex-basis: 150px; margin: 0 10px; }
        .attendee-type-item .percentage { min-width: 40px; text-align: right; font-weight: bold; }
        .add-type-section { margin-top: 15px; display: flex; align-items: center; }
        .add-type-section input[type="text"] { flex-grow: 1; margin-right: 10px; margin-bottom: 0; }
        .add-type-section button { margin-top: 0; }
        #total-percentage { margin-top: 10px; font-weight: bold; }
        #config-output { margin-top: 20px; white-space: pre-wrap; background-color: #eee; padding: 10px; border-radius: 4px; font-family: monospace; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Test Data Generator Configuration</h1>

    <div class="config-section">
        <h2>General Settings</h2>
        <label for="context">Event Context:</label>
        <input type="text" id="context" name="context" value="Tech Conference 2025">

        <label for="total-profiles">Total Profiles:</label>
        <input type="number" id="total-profiles" name="total-profiles" value="50" min="1">
    </div>

    <div class="config-section">
        <h2>Attendee Type Distribution</h2>
        <p>Define the types of attendees and their approximate proportion.</p>
        <ul id="attendee-type-list" class="attendee-type-list">
            <!-- Attendee types will be loaded here -->
        </ul>
        <div id="total-percentage">Total Percentage: 0%</div>
        <div class="add-type-section">
            <input type="text" id="new-attendee-type" placeholder="Add Custom Attendee Type">
            <button id="add-type-btn">Add Type</button>
        </div>
         <div id="percentage-error" class="error" style="display: none;">Total percentage must be 100% to generate config.</div>
    </div>

    <div class="config-section">
        <h2>Response Style Examples</h2>
        <p>Provide examples to guide the desired length/style variation (replaces 'verbosity').</p>
        <label for="short-response">Short Response Example:</label>
        <textarea id="short-response" name="short-response">UX Designer looking for frontend collaborators.</textarea>

        <label for="long-response">Long Response Example:</label>
        <textarea id="long-response" name="long-response">Lead data scientist here, wrangling terabytes for breakfast at BigCloud Corp. My team's pioneering ethical AI frameworks for recommendation engines. At [Context] hoping to spark conversations about responsible scaling and maybe find the missing puzzle piece for our bias mitigation strategy. Love talking shop about MLOps or obscure sci-fi.</textarea>
    </div>

    <button id="generate-config-btn">Generate Config File</button>

    <div id="config-output-container" style="display: none;">
        <h2>Generated Configuration:</h2>
        <pre id="config-output"></pre>
        <a id="download-link" href="#" download="test_audience_config.json"><button>Download test_audience_config.json</button></a>
        <button id="copy-config-btn" style="margin-left: 10px;">Copy to Clipboard</button>
        <p><small>Download the file and manually save it as 'test_audience_config.json' in the 'generator' directory, or copy the text and paste it into the file.</small></p>
    </div>


    <script>
        const attendeeTypeList = document.getElementById('attendee-type-list');
        const newAttendeeTypeInput = document.getElementById('new-attendee-type');
        const addTypeBtn = document.getElementById('add-type-btn');
        const totalPercentageDisplay = document.getElementById('total-percentage');
        const generateConfigBtn = document.getElementById('generate-config-btn');
        const configOutputContainer = document.getElementById('config-output-container');
        const configOutput = document.getElementById('config-output');
        const downloadLink = document.getElementById('download-link');
        const contextInput = document.getElementById('context');
        const totalProfilesInput = document.getElementById('total-profiles');
        const shortResponseInput = document.getElementById('short-response');
        const longResponseInput = document.getElementById('long-response');
        const percentageError = document.getElementById('percentage-error');
        const copyConfigBtn = document.getElementById('copy-config-btn');


        let attendeeTypes = []; // { name: string, included: boolean, percentage: number }

        // --- Attendee Type Management ---

        function renderAttendeeTypes() {
            attendeeTypeList.innerHTML = ''; // Clear existing list
            let currentTotalPercentage = 0;

            attendeeTypes.forEach((type, index) => {
                const listItem = document.createElement('li');
                listItem.classList.add('attendee-type-item');

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = type.included;
                checkbox.id = `type-${index}`;
                checkbox.addEventListener('change', () => {
                    attendeeTypes[index].included = checkbox.checked;
                    slider.disabled = !checkbox.checked;
                    if (!checkbox.checked) {
                        // Set percentage to 0 if excluded, but keep original value for re-inclusion? No, easier to reset.
                         attendeeTypes[index].percentage = 0;
                         slider.value = 0;
                         percentageSpan.textContent = '0%';
                    }
                    // Maybe distribute remaining percentage? For now, just let user readjust.
                     updateTotalPercentage();
                });

                const label = document.createElement('label');
                label.htmlFor = `type-${index}`;
                label.textContent = type.name;

                const slider = document.createElement('input');
                slider.type = 'range';
                slider.min = 0;
                slider.max = 100;
                slider.value = type.percentage;
                slider.disabled = !type.included;
                slider.addEventListener('input', () => {
                    const newPercentage = parseInt(slider.value, 10);
                    attendeeTypes[index].percentage = newPercentage;
                    percentageSpan.textContent = `${newPercentage}%`;
                    updateTotalPercentage();
                });

                const percentageSpan = document.createElement('span');
                percentageSpan.classList.add('percentage');
                percentageSpan.textContent = `${type.percentage}%`;

                // Maybe add a remove button for custom types? For now, exclude is enough.

                listItem.appendChild(checkbox);
                listItem.appendChild(label);
                listItem.appendChild(slider);
                listItem.appendChild(percentageSpan);
                attendeeTypeList.appendChild(listItem);

                if (type.included) {
                    currentTotalPercentage += type.percentage;
                }
            });
            updateTotalPercentage(); // Update display after rendering
        }

        function updateTotalPercentage() {
            let total = attendeeTypes.reduce((sum, type) => {
                return sum + (type.included ? type.percentage : 0);
            }, 0);
            totalPercentageDisplay.textContent = `Total Percentage: ${total}%`;
            totalPercentageDisplay.style.color = total === 100 ? 'green' : 'red';
            percentageError.style.display = total === 100 ? 'none' : 'block';

        }

        function addAttendeeType(name) {
            if (!name || attendeeTypes.some(t => t.name.toLowerCase() === name.toLowerCase())) {
                alert('Please enter a unique attendee type name.');
                return;
            }
            attendeeTypes.push({ name: name, included: true, percentage: 0 }); // Add as included, 0% initially
            renderAttendeeTypes();
        }

        addTypeBtn.addEventListener('click', () => {
            const newName = newAttendeeTypeInput.value.trim();
            addAttendeeType(newName);
            newAttendeeTypeInput.value = ''; // Clear input
        });

        // Load initial types
        async function loadInitialTypes() {
            try {
                const response = await fetch('attendee_types.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const defaultTypes = await response.json();
                 // Distribute initial percentage somewhat evenly among defaults
                const initialPercentage = defaultTypes.length > 0 ? Math.floor(100 / defaultTypes.length) : 0;
                let remainder = defaultTypes.length > 0 ? 100 % defaultTypes.length : 0;

                attendeeTypes = defaultTypes.map((name, index) => {
                     const percentage = initialPercentage + (index < remainder ? 1 : 0); // Distribute remainder
                     return { name, included: true, percentage: percentage };
                 });
                renderAttendeeTypes();
            } catch (error) {
                console.error('Error loading attendee_types.json:', error);
                attendeeTypeList.innerHTML = '<li class="error">Could not load default attendee types. Please add manually.</li>';
            }
        }

        // --- Config Generation ---

        generateConfigBtn.addEventListener('click', () => {
            const includedTypes = attendeeTypes.filter(t => t.included);
            const totalPercentage = includedTypes.reduce((sum, type) => sum + type.percentage, 0);

            if (totalPercentage !== 100) {
                alert('Total percentage for included attendee types must be exactly 100%.');
                return;
            }

             if (!contextInput.value.trim()) {
                alert('Please enter an Event Context.');
                return;
            }
            if (parseInt(totalProfilesInput.value, 10) <= 0) {
                alert('Please enter a valid Total Profiles number greater than 0.');
                return;
            }

            const config = {
                context: contextInput.value.trim(),
                total_profiles: parseInt(totalProfilesInput.value, 10),
                attendee_type_distribution: includedTypes.map(t => ({
                    type: t.name,
                    percentage: t.percentage
                })),
                response_examples: {
                    short: shortResponseInput.value.trim(),
                    long: longResponseInput.value.trim()
                }
                // Add other fields here if needed in the future
            };

            const configJson = JSON.stringify(config, null, 2);
            configOutput.textContent = configJson;

            // Create blob and trigger download
            const blob = new Blob([configJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;

            configOutputContainer.style.display = 'block'; // Show the output section
        });

        // --- Add Copy Button Logic ---
        copyConfigBtn.addEventListener('click', () => {
            const jsonToCopy = configOutput.textContent;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(jsonToCopy).then(() => {
                    // Success feedback
                    const originalText = copyConfigBtn.textContent;
                    copyConfigBtn.textContent = 'Copied!';
                    setTimeout(() => {
                        copyConfigBtn.textContent = originalText;
                    }, 1500); // Reset text after 1.5 seconds
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    alert('Failed to copy JSON to clipboard.');
                });
            } else {
                // Fallback for older browsers (less common now)
                alert('Clipboard API not available in this browser.');
            }
        });

        // --- Initial Load ---
        loadInitialTypes();

    </script>

</body>
</html> 