direction: down
title: "Backend Service Interactions"

# --- Entry Point ---
APIGateway: API Gateway {
  shape: hexagon
  style.fill: "#ffbb50"
}

# Core Application Services
Application_Services: {
  style.fill: "#f0f0f0" # Light grey for container
  label: "Application Services"

  OnboardingService: Onboarding Service { shape: rectangle; style.fill: "#e0f7fa" }
  AuthenticationService: Authentication Service { shape: rectangle; style.fill: "#e0f7fa" }
  UserService: User Service { shape: rectangle; style.fill: "#e0f7fa" }
  ProfileService: Profile Service { shape: rectangle; style.fill: "#e0f7fa" }
  EventService: Event Service { shape: rectangle; style.fill: "#e0f7fa" }
  MatchService: Match Service { shape: rectangle; style.fill: "#e0f7fa" }
  ContentExtractionService: Content Extraction Service { shape: rectangle; style.fill: "#e0f7fa" }
}

# AWS Managed / External Dependencies
Dependencies: {
  style.fill: "#f0f0f0" # Light grey for container
  label: "Dependencies"

  RDS: RDS (PostgreSQL) {
      shape: cylinder # Use standard cylinder shape
      style.fill: "#a0c4ff"
  }
  S3: S3 Bucket {
      shape: cylinder # Use standard cylinder shape
      style.fill: "#ffbdbd"
  }
  Transcribe: AWS Transcribe (STT) {
      shape: rectangle
      style: {
        fill: "#fff6a0"
      }
  }
  Cognito: AWS Cognito {
      shape: rectangle
      style: {
         fill: "#ffcaa0"
      }
  }
  LLMService: LLM Service {
      shape: rectangle
      style: {
         fill: "#caffbf"
      }
  }
  QdrantCloud: Qdrant Cloud {
      shape: cylinder
      style.fill: "#bdb2ff"
  }
}


# Connections
APIGateway -> Application_Services.OnboardingService: "/onboarding/*"
APIGateway -> Application_Services.AuthenticationService: "/auth/callback"

Application_Services.OnboardingService -> Application_Services.UserService: "Create/Update User"
Application_Services.OnboardingService -> Application_Services.ProfileService: "Create Profile,\nProcess Audio"
Application_Services.OnboardingService -> Application_Services.EventService: "Create Participation,\nProcess Audio"
Application_Services.OnboardingService -> Dependencies.RDS: "CRUD Session"
Application_Services.OnboardingService -> Dependencies.S3: "Gen Presigned URL"
Application_Services.OnboardingService -> Application_Services.MatchService: "Trigger Matching"

Application_Services.AuthenticationService -> Dependencies.Cognito: "Exchange Code"
Application_Services.AuthenticationService -> Application_Services.OnboardingService: "Finalize"

Application_Services.UserService -> Dependencies.RDS: "CRUD User"

Application_Services.ProfileService -> Dependencies.RDS: "CRUD Profile"
Application_Services.ProfileService -> Application_Services.ContentExtractionService: "Extract Profile Data"
Application_Services.ProfileService -> Dependencies.QdrantCloud: "Store Profile Emb."

Application_Services.EventService -> Dependencies.RDS: "CRUD Participation"
Application_Services.EventService -> Application_Services.ContentExtractionService: "Extract Event Data"
Application_Services.EventService -> Dependencies.QdrantCloud: "Store Context Emb."

Application_Services.ContentExtractionService -> Dependencies.S3: "Get Audio"
Application_Services.ContentExtractionService -> Dependencies.Transcribe: "Transcribe"
Application_Services.ContentExtractionService -> Dependencies.LLMService: "Parse Transcript"

Application_Services.MatchService -> Dependencies.RDS: "Fetch Data"
Application_Services.MatchService -> Dependencies.QdrantCloud: "Search Embeddings"
Application_Services.MatchService -> Dependencies.LLMService: "Explain Match" 