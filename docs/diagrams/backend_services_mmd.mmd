graph TD
    %% Define Styles/Classes (Optional, for better visual distinction if needed)
    %% classDef aws fill:#ffbb50,stroke:#333,stroke-width:2px;
    %% classDef appSvc fill:#e0f7fa,stroke:#333;
    %% classDef db fill:#a0c4ff,stroke:#333;
    %% classDef storage fill:#ffbdbd,stroke:#333;
    %% classDef external fill:#caffbf,stroke:#333;

    %% --- Entry Point ---
    APIGateway{{API Gateway}}

    %% --- Core Application Services ---
    subgraph Application Services
        direction TB
        OnboardingService(Onboarding Service)
        AuthenticationService(Authentication Service)
        UserService(User Service)
        ProfileService(Profile Service)
        EventService(Event Service)
        MatchService(Match Service)
        ContentExtractionService(Content Extraction Service)
    end

    %% --- AWS Managed / External Dependencies ---
    subgraph Dependencies
        direction TB
        RDS[(RDS - PostgreSQL)]
        S3[(S3 Bucket)]
        Transcribe(AWS Transcribe - STT)
        Cognito(AWS Cognito)
        LLMService(LLM Service)
        QdrantCloud[(Qdrant Cloud)]
    end

    %% --- Connections ---
    APIGateway -- "/onboarding/*" --> OnboardingService
    APIGateway -- "/auth/callback" --> AuthenticationService

    OnboardingService -- "Create/Update User" --> UserService
    OnboardingService -- "Create Profile, Process Audio" --> ProfileService
    OnboardingService -- "Create Participation, Process Audio" --> EventService
    OnboardingService -- "CRUD Session" --> RDS
    OnboardingService -- "Gen Presigned URL" --> S3
    OnboardingService -- "Trigger Matching" --> MatchService

    AuthenticationService -- "Exchange Code" --> Cognito
    AuthenticationService -- "Finalize" --> OnboardingService

    UserService -- "CRUD User" --> RDS

    ProfileService -- "CRUD Profile" --> RDS
    ProfileService -- "Extract Profile Data" --> ContentExtractionService
    ProfileService -- "Store Profile Emb." --> QdrantCloud

    EventService -- "CRUD Participation" --> RDS
    EventService -- "Extract Event Data" --> ContentExtractionService
    EventService -- "Store Context Emb." --> QdrantCloud

    ContentExtractionService -- "Get Audio" --> S3
    ContentExtractionService -- "Transcribe" --> Transcribe
    ContentExtractionService -- "Parse Transcript" --> LLMService

    MatchService -- "Fetch Data" --> RDS
    MatchService -- "Search Embeddings" --> QdrantCloud
    MatchService -- "Explain Match" --> LLMService 